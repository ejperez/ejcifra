webpackJsonp([1],{"0KgP":function(e,t){},AgMl:function(e,t){},"Dz/7":function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("7+uW"),a=s("mtWM"),r=s.n(a),o=(s("MU8w"),s("lbHh")),i=s.n(o),u={getLoggedInUser:function(){var e=i.a.get("user"),t=i.a.get("token");return e&&t?{name:(e=JSON.parse(e)).name}:null},refresh:function(e,t){var s={headers:{Authorization:"Bearer "+i.a.get("token")}};i.a.remove("token"),r.a.post(window.apiHost+"/auth/refresh",{},s).then(function(t){i.a.set("token",t.data.access_token),e(t)}).catch(function(e){t(e)})},login:function(e,t,s,n){var a={email:s,password:n};r.a.post(window.apiHost+"/auth/login",a).then(function(s){i.a.set("token",s.data.access_token);var n={headers:{Authorization:"Bearer "+i.a.get("token")}};r.a.post(window.apiHost+"/auth/me",{},n).then(function(t){i.a.set("user",t.data),e(t)}).catch(function(e){t(e)})}).catch(function(e){t(e)})},logout:function(e,t){var s={headers:{Authorization:"Bearer "+i.a.get("token")}};r.a.post(window.apiHost+"/auth/logout",{},s).then(function(t){i.a.remove("token"),i.a.remove("user"),e(t)}).catch(function(e){t(e)})}},c=(s("Jmt5"),{name:"App",computed:{alertClass:function(){return"alert alert-dismissible fade show alert-"+this.messageType}},data:function(){return{user:null,message:!1,messageType:"success",showProgress:!1}},created:function(){var e=this;this.user=u.getLoggedInUser(),this.handlers={success:function(t){e.user=u.getLoggedInUser(),e.$router.push({name:"SongsIndex"})},error:function(e){console.debug(e)}};var t=document.createElement("script");t.setAttribute("src","static/vendor/bootstrap.native/dist/bootstrap-native-v4.min.js"),document.head.appendChild(t)},methods:{updateAuthUser:function(){this.user=u.getLoggedInUser()},logout:function(){u.logout(this.handlers.success,this.handlers.error)},showMessage:function(e){var t=this;this.message=e.message,this.messageType=e.type,setTimeout(function(){t.message=!1,t.messageType="success"},1e4)},hideAlert:function(){this.message=!1},progress:function(e){this.showProgress=e}}}),l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("nav",{staticClass:"navbar navbar-expand-lg navbar-light bg-light sticky-top"},[s("a",{staticClass:"navbar-brand",attrs:{href:"#"}},[e._v("ejcifra")]),e._v(" "),e._m(0),e._v(" "),s("div",{staticClass:"collapse navbar-collapse",attrs:{id:"navbarNav"}},[s("ul",{staticClass:"navbar-nav ml-auto"},[s("li",{staticClass:"nav-item"}),e._v(" "),s("li",{staticClass:"nav-item"}),e._v(" "),e.user?[s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link disabled",attrs:{href:"#"},domProps:{innerHTML:e._s(e.user.name)}})]),e._v(" "),s("li",{staticClass:"nav-item"},[s("a",{staticClass:"nav-link",attrs:{href:"#"},on:{click:function(t){e.logout()}}},[e._v("Log out")])])]:[s("li",{staticClass:"nav-item"},[s("router-link",{staticClass:"nav-link",attrs:{to:{name:"AuthLogin"}}},[e._v("Log in")])],1)]],2)])]),e._v(" "),e.showProgress?s("div",{attrs:{id:"overlay"}},[e._m(1)]):e._e(),e._v(" "),e.message?s("div",{class:e.alertClass,attrs:{role:"alert"}},[s("span",{domProps:{innerHTML:e._s(e.message)}}),s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"alert","aria-label":"Close"},on:{click:e.hideAlert}},[s("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])])]):e._e(),e._v(" "),s("div",{staticClass:"container-fluid"},[s("router-view",{on:{progress:e.progress,"show-message":e.showMessage,"logged-in":e.updateAuthUser}})],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"navbar-toggler",attrs:{type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"}},[t("span",{staticClass:"navbar-toggler-icon"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"progress"},[t("div",{staticClass:"progress-bar progress-bar-striped progress-bar-animated",staticStyle:{width:"100%"},attrs:{role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})])}]};var d=s("VU/8")(c,l,!1,function(e){s("AgMl")},"data-v-60de68de",null).exports,g=s("/ocq"),m={saveDraft:function(e){localStorage.setItem("songDraft",e)},getDraft:function(){return localStorage.getItem("songDraft")},removeDraft:function(){return localStorage.removeItem("songDraft")},get:function(e,t,s,n){r.a.get(window.apiHost+"/songs",{params:{search:s,page:n}}).then(function(t){e(t)}).catch(function(e){t(e)})},getSingle:function(e,t,s){r.a.get(window.apiHost+"/songs/"+s).then(function(t){e(t)}).catch(function(e){t(e)})},duplicate:function(e,t,s){var n=this;n.getSingle(function(s){var a=s.data;n.save(e,t,!1,a)},t,s)},save:function(e,t,s,n){var a=window.apiHost+"/songs",o="post",c=this;s&&(a+="/"+s,o="put"),r()({url:a,data:n,method:o,headers:{Authorization:"Bearer "+i.a.get("token")}}).then(function(t){e(t)}).catch(function(a){"Unauthenticated."===a.response.data.error?u.refresh(function(){c.save(e,t,s,n)},t):t(a)})},delete:function(e,t,s){var n=this,a={headers:{Authorization:"Bearer "+i.a.get("token")}};r.a.delete(window.apiHost+"/songs/"+s,a).then(function(t){e(t)}).catch(function(a){"Unauthenticated."===a.response.data.error?u.refresh(function(){n.delete(e,t,s)},t):t(a)})}},h={name:"SongsIndex",data:function(){return{msg:"Songs",songs:[],searchKeyword:"",pages:[],currentPage:1}},created:function(){var e=this;this.handlers={success:function(t){if(t.data.data.length){e.songs=t.data.data,e.pages=[];for(var s=0;s<t.data.last_page;s++)e.pages.push(s+1)}else e.$emit("show-message",{message:"No songs matching your search. Please try again.",type:"info"});e.$emit("progress",!1)},error:function(t){console.debug(t),e.$emit("progress",!1)}}},mounted:function(){this.$emit("progress",!0),m.get(this.handlers.success,this.handlers.error)},methods:{search:function(){if(this.searchKeyword){this.currentPage=1,this.$emit("progress",!0),m.get(this.handlers.success,this.handlers.error,this.searchKeyword)}},goToPage:function(e){this.$emit("progress",!0),this.currentPage=e,m.get(this.handlers.success,this.handlers.error,this.searchKeyword,e)}}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index"},[s("h1",[e._v(e._s(e.msg))]),e._v(" "),s("form",{on:{submit:function(t){t.preventDefault(),e.search()}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"Title or artist name"},domProps:{value:e.searchKeyword},on:{input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}}),e._v(" "),s("button",{attrs:{type:"submit"}},[e._v("Search")])]),e._v(" "),s("ul",e._l(e.songs,function(t){return s("li",{key:t.id},[s("router-link",{attrs:{to:{name:"SongsView",params:{id:t.id,slug:t.slug}}}},[e._v(e._s(t.title)+" - "+e._s(t.artists)+" "+e._s(t.comment?"("+t.comment+")":""))])],1)})),e._v(" "),s("nav",{attrs:{"aria-label":"Pagination"}},[s("ul",{staticClass:"pagination justify-content-center"},e._l(e.pages,function(t){return s("li",{key:t,staticClass:"page-item",class:{active:e.currentPage===t}},[s("a",{staticClass:"page-link",domProps:{innerHTML:e._s(t)},on:{click:function(s){e.goToPage(t)}}})])}))])])},staticRenderFns:[]};var p=s("VU/8")(h,v,!1,function(e){s("jpv8")},"data-v-d7014266",null).exports,f={name:"SongsView",props:["id","slug"],data:function(){return{song:{title:"",artists:"",key:"",bpm:"",meter:"",comment:!1},content:"",keys:["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"],neyKey:null}},created:function(){var e=this;this.handlers={success:function(t){t.data?(e.song=t.data,e.content=ChordPlus.getHTML(e.song.body)):e.$emit("show-message",{message:"No songs matching your search. Please try again.",type:"info"})},error:function(e){console.debug(e)}};var t=document.createElement("script");t.setAttribute("src","static/vendor/chord-plus/dist/chord-plus.min.js"),document.head.appendChild(t)},mounted:function(){m.getSingle(this.handlers.success,this.handlers.error,this.id)},methods:{transpose:function(){this.song&&(this.content=ChordPlus.getHTML(this.song.body,this.song.key,this.newKey))},reset:function(){this.song&&(this.newKey=null,this.content=ChordPlus.getHTML(this.song.body,this.song.key))}}},_={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index"},[s("nav",{attrs:{"aria-label":"breadcrumb"}},[s("ol",{staticClass:"breadcrumb"},[s("router-link",{staticClass:"breadcrumb-item",attrs:{to:{name:"SongsIndex"}}},[e._v("Songs")]),e._v(" "),s("li",{staticClass:"breadcrumb-item active",attrs:{"aria-current":"page"}},[e._v(e._s(e.song.title))])],1)]),e._v(" "),s("div",[s("label",[e._v("Change key")]),e._v(" "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.newKey,expression:"newKey"}],on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.newKey=t.target.multiple?s:s[0]},function(t){e.transpose()}]}},e._l(e.keys,function(t){return s("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])})),e._v(" "),s("button",{attrs:{type:"button"},on:{click:function(t){e.reset()}}},[e._v("Reset")])]),e._v(" "),s("div",[e._v(e._s(e.song.title)+" "),e.song.artists?s("span",[e._v("-")]):e._e(),e._v(" "+e._s(e.song.artists))]),e._v(" "),s("div",[s("ul",[s("li",[e._v("Key: "+e._s(e.newKey||e.song.key))]),e._v(" "),s("li",[e._v("BPM: "+e._s(e.song.bpm))]),e._v(" "),s("li",[e._v("Meter: "+e._s(e.song.meter))]),e._v(" "),e.song.commet?s("li",[e._v(e._s(e.song.comment))]):e._e()])]),e._v(" "),s("div",{domProps:{innerHTML:e._s(e.content)}})])},staticRenderFns:[]};var y=s("VU/8")(f,_,!1,function(e){s("Dz/7")},"data-v-30e4ff26",null).exports,b={name:"AuthLogin",data:function(){return{email:"",password:""}},created:function(){var e=this;this.handlers={success:function(t){e.$emit("logged-in"),e.$route.query.hasOwnProperty("redirect")?e.$router.push({path:e.$route.query.redirect}):e.$router.push({name:"AdminSongsIndex"})},error:function(t){var s=t.response.data.error;e.$emit("show-message",{message:s,type:"danger"})}}},mounted:function(){},methods:{login:function(){this.email&&this.password&&u.login(this.handlers.success,this.handlers.error,this.email,this.password)}}},w={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index"},[s("h1",[e._v("Log in")]),e._v(" "),s("ul",[s("li",[s("router-link",{attrs:{to:{name:"SongsIndex"}}},[e._v("Songs")])],1)]),e._v(" "),s("form",{on:{submit:function(t){t.preventDefault(),e.login()}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],attrs:{placeholder:"Email",type:"email"},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}}),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{placeholder:"Password",type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._v(" "),s("button",{attrs:{type:"submit"}},[e._v("Log in")])])])},staticRenderFns:[]};var k=s("VU/8")(b,w,!1,function(e){s("qse0")},"data-v-ce9b8c48",null).exports,A={name:"AdminSongsIndex",data:function(){return{msg:"Admin Songs",songs:[],searchKeyword:"",pages:[],currentPage:1}},created:function(){var e=this;this.handlers={duplicateSuccess:function(t){var s=t.data;e.$emit("show-message",{message:"Successfully duplicated "+s.title,type:"success"}),m.get(e.handlers.success,e.handlers.error)},deleteSuccess:function(t){e.$emit("show-message",{message:t.data.message,type:"success"}),m.get(e.handlers.success,e.handlers.error)},success:function(t){if(t.data.data.length){e.songs=t.data.data,e.pages=[];for(var s=0;s<t.data.last_page;s++)e.pages.push(s+1)}else e.$emit("show-message",{message:"No songs matching your search. Please try again.",type:"info"})},error:function(t){var s=t.response.data.error;e.$emit("show-message",{message:s,type:"danger"})}}},mounted:function(){m.get(this.handlers.success,this.handlers.error)},methods:{search:function(){if(this.searchKeyword){this.currentPage=1,m.get(this.handlers.success,this.handlers.error,this.searchKeyword)}},goToPage:function(e){this.currentPage=e,m.get(this.handlers.success,this.handlers.error,this.searchKeyword,e)},remove:function(e){confirm("Delete "+e.title+"?")&&m.delete(this.handlers.deleteSuccess,this.handlers.error,e.id)},duplicate:function(e){confirm("Duplicate "+e.title+"?")&&m.duplicate(this.handlers.duplicateSuccess,this.handlers.error,e.id)}}},P={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index"},[s("h1",[e._v(e._s(e.msg))]),e._v(" "),s("ul",[s("li",[s("router-link",{attrs:{to:{name:"AdminSongsAdd"}}},[e._v("Add new")])],1)]),e._v(" "),s("form",{on:{submit:function(t){t.preventDefault(),e.search()}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKeyword,expression:"searchKeyword"}],attrs:{type:"text",placeholder:"Title or artist name"},domProps:{value:e.searchKeyword},on:{input:function(t){t.target.composing||(e.searchKeyword=t.target.value)}}}),e._v(" "),s("button",{attrs:{type:"submit"}},[e._v("Search")])]),e._v(" "),s("ul",e._l(e.songs,function(t){return s("li",{key:t.id},[s("span",[e._v(e._s(t.title)+" "),t.artists?s("span",[e._v("-")]):e._e(),e._v(" "+e._s(t.artists)+" "+e._s(t.comment?"("+t.comment+")":""))]),e._v(" "),s("router-link",{attrs:{to:{name:"AdminSongsEdit",params:{id:t.id,slug:t.slug}}}},[e._v("Edit")]),e._v(" "),s("button",{attrs:{type:"button"},on:{click:function(s){e.duplicate(t)}}},[e._v("Duplicate")]),e._v(" "),s("button",{attrs:{type:"button"},on:{click:function(s){e.remove(t)}}},[e._v("Delete")])],1)})),e._v(" "),s("ul",e._l(e.pages,function(t){return s("li",{key:t},[s("button",{attrs:{disabled:e.currentPage===t,type:"button"},on:{click:function(s){e.goToPage(t)}}},[e._v(e._s(t))])])}))])},staticRenderFns:[]};var S=s("VU/8")(A,P,!1,function(e){s("0KgP")},"data-v-7fcf29fe",null).exports,C=s("mvHQ"),x=s.n(C),$={name:"AdminSongsAddEdit",props:["id","slug"],data:function(){return{song:{title:"",artists:"",key:"C",bpm:100,meter:"4/4",comment:""},symbols:["[","]","|","/","#",":","-","_","(",")"],meters:["4/4","3/4","6/8"],keys:["C","C#","Db","D","D#","Eb","E","F","F#","Gb","G","G#","Ab","A","A#","Bb","B"],neyKey:null}},created:function(){var e=this;this.handlers={getSuccess:function(t){e.song=t.data},success:function(t){var s=t.data;m.removeDraft(),e.id?(e.song=s,e.$emit("show-message",{message:"Saved.",type:"success"})):e.$router.push({name:"AdminSongsEdit",params:{id:s.id,slug:s.slug}})},error:function(t){var s=t.response.data.error;"Unauthenticated."===s&&(e.$emit("logged-in"),e.$router.push({name:"AuthLogin",query:{redirect:e.$route.fullPath}})),e.$emit("show-message",{message:s,type:"danger"})}}},mounted:function(){if(this.id)m.getSingle(this.handlers.getSuccess,this.handlers.error,this.id);else{var e=m.getDraft();e&&(this.song=JSON.parse(e))}},methods:{save:function(){m.saveDraft(x()(this.song)),m.save(this.handlers.success,this.handlers.error,this.id,this.song)},insertToEditor:function(e){var t=document.getElementById("editor"),s=t.selectionStart;t.value=t.value.substring(0,s)+e+t.value.substring(s,t.value.length),t.selectionStart=t.selectionEnd=s+e.length,t.focus(),t.dispatchEvent(new Event("input"))}}},K={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"index"},[s("ul",[s("li",[s("router-link",{attrs:{to:{name:"AdminSongsIndex"}}},[e._v("Admin Songs")])],1),e._v(" "),e.id?s("li",[e._v(e._s(e.song.title))]):e._e()]),e._v(" "),s("form",{on:{submit:function(t){t.preventDefault(),e.save()}}},[e._v("\n\t\t\tTitle: "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.song.title,expression:"song.title"}],attrs:{required:"",type:"text"},domProps:{value:e.song.title},on:{input:function(t){t.target.composing||e.$set(e.song,"title",t.target.value)}}}),s("br"),e._v("\n\t\t\tArtists: "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.song.artists,expression:"song.artists"}],attrs:{type:"text"},domProps:{value:e.song.artists},on:{input:function(t){t.target.composing||e.$set(e.song,"artists",t.target.value)}}}),s("br"),e._v("\n\t\t\tKey: "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.song.key,expression:"song.key"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(e.song,"key",t.target.multiple?s:s[0])}}},e._l(e.keys,function(t){return s("option",{key:t,domProps:{value:t,innerHTML:e._s(t)}})})),s("br"),e._v("\n\t\t\tMeter: "),s("select",{directives:[{name:"model",rawName:"v-model",value:e.song.meter,expression:"song.meter"}],on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(e.song,"meter",t.target.multiple?s:s[0])}}},e._l(e.meters,function(t){return s("option",{key:t,domProps:{value:t,innerHTML:e._s(t)}})})),s("br"),e._v("\n\t\t\tBPM: "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.song.bpm,expression:"song.bpm"}],attrs:{required:"",type:"number"},domProps:{value:e.song.bpm},on:{input:function(t){t.target.composing||e.$set(e.song,"bpm",t.target.value)}}}),s("br"),e._v("\n\t\t\tComment: "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.song.comment,expression:"song.comment"}],attrs:{type:"text"},domProps:{value:e.song.comment},on:{input:function(t){t.target.composing||e.$set(e.song,"comment",t.target.value)}}}),s("br"),e._v("\n\t\t\tBody:"),s("br"),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.song.body,expression:"song.body"}],attrs:{id:"editor",required:"",cols:"30",rows:"10"},domProps:{value:e.song.body},on:{input:function(t){t.target.composing||e.$set(e.song,"body",t.target.value)}}}),s("br"),e._v(" "),s("button",{attrs:{type:"submit"}},[e._v("Save")])]),e._v(" "),s("ul",e._l(e.symbols,function(t){return s("li",{key:t},[s("button",{attrs:{type:"button"},domProps:{innerHTML:e._s(t)},on:{click:function(s){e.insertToEditor(t)}}})])}))])},staticRenderFns:[]};var E=s("VU/8")($,K,!1,function(e){s("kMAP")},"data-v-7873a37b",null).exports;n.a.use(g.a);var T=new g.a({routes:[{path:"/",name:"SongsIndex",component:p},{path:"/songs",name:"SongsIndex",component:p},{path:"/songs/:id/:slug",name:"SongsView",component:y,props:!0},{path:"/login",name:"AuthLogin",component:k},{path:"/admin/songs",name:"AdminSongsIndex",component:S,meta:{requiresAuth:!0}},{path:"/admin/songs/add",name:"AdminSongsAdd",component:E,meta:{requiresAuth:!0}},{path:"/admin/songs/:id/:slug/edit",name:"AdminSongsEdit",props:!0,component:E,meta:{requiresAuth:!0}}]});T.beforeEach(function(e,t,s){e.matched.some(function(e){return e.meta.requiresAuth})?u.getLoggedInUser()?s():s({path:"/login",query:{redirect:e.fullPath}}):s()});var D=T;n.a.config.productionTip=!1,window.apiHost="https://ejcifra-api.herokuapp.com/api",new n.a({el:"#app",router:D,components:{App:d},template:"<App/>"})},jpv8:function(e,t){},kMAP:function(e,t){},qse0:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.a7389c570a4bf14d471f.js.map